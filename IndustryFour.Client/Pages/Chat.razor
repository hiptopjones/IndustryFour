@page "/chat"

<PageTitle>Industry 4.0 - Chat</PageTitle>

<h1>Chat</h1>
<form id="input-form">
    <div class="mb-3">
        <label for="input-prompt" class="form-label">Enter your question:</label>
        <input type="text" class="form-control mb-4 m-auto" id="input-prompt" @bind="Question" />
    </div>
    <button type="button" class="btn btn-success" disabled="@IsTaskRunning" @onclick="Click">Ask Question!</button>
</form>
<div class="mt-4" id="input-result">
    @if (Response is not null)
    {
        <div class="card card-body mb-3">
            <h5 class="card-title">Question</h5>
            <p class="card-text" style="white-space: pre-line">@Response.Request.Question</p>
        </div>

        <div class="collapse show mb-3" id="relevantChunks">
            <div class="card card-body bg-secondary-subtle">
                <h5 class="card-title">Relevant Chunks</h5>
                <div class="card-text">
                    @foreach (var chunk in Response.Chunks)
                    {
                        <p style="white-space: pre-line">@chunk</p>
                        <hr />
                    }

                    <p><em>Took @(Response.SimilaritySearchDuration.TotalSeconds.ToString("N1"))s</em></p>
                </div>
            </div>
        </div>

        <div class="collapse show mb-3" id="finalPrompt">
            <div class="card card-body bg-secondary-subtle">
                <h5 class="card-title">Final Prompt</h5>
                <div class="card-text">
                    <p style="white-space: pre-line">@Response.Prompt</p>
                    <p><em>Took @(Response.ChatProviderDuration.TotalSeconds.ToString("N1"))s</em></p>
                </div>
            </div>
        </div>

        <div class="card card-body mb-3">
            <h5 class="card-title">Answer</h5>
            <p class="card-text" style="white-space: pre-line">@Response.Answer</p>
        </div>

        <p class="mb-3">
            <button class="btn btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#relevantChunks" aria-expanded="false" aria-controls="relevantChunks">
                Relevant Chunks
            </button>
            <button class="btn btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#finalPrompt" aria-expanded="false" aria-controls="finalPrompt">
                Final Prompt
            </button>
        </p>
    }
    else if (Error is not null)
    {
        <div class="card card-body">
            <pre>@Error</pre>
        </div>
    }
    else
    {
        @if (IsTaskRunning)
        {
            <p>Asking question...</p>
        }
    }
</div>